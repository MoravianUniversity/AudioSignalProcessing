!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(1),i=r(2);class a{constructor(t){this.processing=s.WA_XCORR,this.sampleRate=44100,this.setMode(t),this.gccphat=new n.Gccphat(this.sampleRate),this.waxcorr=new i.Waxcorr(this.sampleRate),this.prewhiten=o.NONE}async correlate(t,e){switch(t.length!=e.length&&(t.length>e.length?t=t.slice(0,e.length):e=e.slice(0,e.length)),this.prewhiten){case o.NONE:case o.MEAN_REMOVAL:case o.TREND_REMOVAL:}let r;return new Promise((n,i)=>{switch(this.processing){case s.GCC_PHAT:r=this.gccphat.xcorr(t,e),r=a.normalize(r),n(r);break;case s.WA_XCORR:this.waxcorr.xcorr(t,e).then(t=>{t=a.normalize(t),n(t)}).catch(t=>console.warn("Warning Waxcorr failed, offlineAudioContext not setup.", t));break;default:r=this.gccphat.xcorr(t,e),r=a.normalize(r),n(r)}})}async timeLag(t,e){const r=await this.correlate(t,e);return this.locatePeakIndex(r)}setMode(t){switch(t){case"waxcorr":this.processing=s.WA_XCORR;break;case"gccphat":this.processing=s.GCC_PHAT}}static indexOfMax(t){if(0===t.length)return-1;let e=t[0],r=0;for(var n=1;n<t.length;n++)t[n]>e&&(r=n,e=Math.abs(t[n]));return r}locatePeakIndex(t){let e,r=a.indexOfMax(t),n=0;return(n=this.processing===s.GCC_PHAT?r>Math.floor(t.length/2)?t.length-r:r:r-this.waxcorr.getOffset())>1?(e=a.interpolate(t[n-1],t[n],t[n+1]),e+=n):e=Math.abs(n),e}static interpolate(t,e,r){let n=.5*(t-r)/(t-2*e+r);return(Math.sqrt(n*n*32+1)-1)/(8*n)}static normalize(t){let e=0,r=new Float32Array(t.length);for(let r=0;r<t.length;r++)Math.abs(t[r])>e&&(e=Math.abs(t[r]));for(let n=0;n<t.length;n++)r[n]=t[n]/e;return r}}var s,o;!function(t){t.WA_XCORR="waxcorr",t.GCC_PHAT="gccphat"}(s||(s={})),function(t){t[t.NONE=0]="NONE",t[t.MEAN_REMOVAL=1]="MEAN_REMOVAL",t[t.TREND_REMOVAL=2]="TREND_REMOVAL"}(o||(o={})),window.xcorr=new a(s.WA_XCORR)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Gccphat=class{constructor(t){this.sampleRate=t,this.libmath=window.math,this.winmath=window.Math,window.initPulse||window.math?window.initPulse().then(t=>{this.pulse=t}):console.warn("GCC-PHAT was not setup correctly!")}xcorr(t,e){var r=this.forwardFFT(t),n=this.forwardFFT(e).conj(),a=i.multiply(r,n),s=a.abs(),o=i.divide(a,s),l=this.inverseFFT(o);return window.resXcorrMath=l,l}forwardFFT(t){void 0!==this.activeFFT&&this.free(),this.activeFFT=new this.pulse.fftReal(t.length);var e=this.activeFFT.forward(t);let r=this.extractReal(e),n=this.extractImag(e),a=new i(e.length);return a.setEntire(r,n),a}inverseFFT(t){let e=new Float32Array(2*t.length),r=0,n=0;for(let i=0;i<e.length;i++)i%2==0?(e[i]=t.data[r].re,r++):(e[i]=t.data[n].im,n++);let i=new Float32Array(e.length);return void 0!==this.activeFFT?(i=this.activeFFT.inverse(e),this.free()):console.warn("Error activeFFT not defined on GCC-PHAT handler!"),i}free(){this.activeFFT.dispose(),this.activeFFT=void 0}extractReal(t){if(t.length%2!=0)return new Float32Array(1);let e=new Float32Array(this.winmath.floor(t.length/2)),r=0;for(let n=0;n<t.length;n++)n%2==0&&(e[r]=t[n],r++);return e}extractImag(t){if(t.length%2!=0)return new Float32Array(1);let e=new Float32Array(this.winmath.floor(t.length/2)),r=0;for(let n=0;n<t.length;n++)n%2!=0&&(e[r]=t[n],r++);return e}};class n{constructor(t,e){this.data=window.math.complex(t,e)}}class i{constructor(t){this.length=t,this.data=new Array(t);for(let e=0;e<t;e++)this.data[e]=new n(0,0)}setEntire(t,e){let r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=window.math.complex(t[n],e[n]);this.data=r,this.length=this.data.length}conj(){let t=new i(this.length);for(let e=0;e<this.length;e++)t.data[e]=window.math.conj(this.data[e]);return t}abs(){let t=new i(this.length);for(let e=0;e<this.length;e++)t.data[e]=window.math.abs(this.data[e]);return t}static multiply(t,e){let r=new i(t.length);for(let n=0;n<t.length;n++)r.data[n]=window.math.multiply(t.data[n],e.data[n]);return r}static divide(t,e){let r=new i(t.length);for(let n=0;n<t.length;n++)r.data[n]=window.math.divide(t.data[n],e.data[n]);return r}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Waxcorr=class{constructor(t){this.offlineAudio=new n(t)}async calculate(t,e,r){return this.offlineAudio.setupGraph(t,e,r),this.offlineAudio.source0&&this.offlineAudio.source0.start(),this.offlineAudio.offlineAudioCtx?this.offlineAudio.offlineAudioCtx.startRendering():Promise.reject()}async xcorr(t,e){let r=t.length+e.length-1;return this.calculate(t,e,r).then(t=>new Promise(e=>{e(t.getChannelData(0))}))}getOffset(){return this.offlineAudio.getOffset()}};class n{constructor(t){this.reverseOffset=0,this.samplingRate=44100,this.samplingRate=t}getOffset(){return this.reverseOffset}setBiquad(t,e,r,n,i){e.gain.setValueAtTime(r,t.currentTime),e.frequency.setValueAtTime(n,t.currentTime),e.Q.setValueAtTime(i,t.currentTime)}free(){}setupGraph(t,e,r){this.offlineAudioCtx=new OfflineAudioContext(1,r,44100),this.source0=this.offlineAudioCtx.createBufferSource(),this.source1=this.offlineAudioCtx.createBufferSource(),this.convolver=this.offlineAudioCtx.createConvolver(),this.biquad0=this.offlineAudioCtx.createBiquadFilter(),this.buffer0=this.offlineAudioCtx.createBuffer(1,t.length,this.samplingRate),this.buffer1=this.offlineAudioCtx.createBuffer(1,e.length,this.samplingRate),this.buffer0.copyToChannel(t,0),this.buffer1.copyToChannel(e,0),this.source0.buffer=this.buffer0,this.source1.buffer=this.buffer1,Array.prototype.reverse.call(this.source1.buffer.getChannelData(0)),this.reverseOffset=this.buffer1.getChannelData(0).length-1,this.convolver.buffer=this.source1.buffer,this.source0.connect(this.convolver),this.convolver.connect(this.offlineAudioCtx.destination)}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3hjb3JyLnRzIiwid2VicGFjazovLy8uL3NyYy9nY2NwaGF0LnRzIiwid2VicGFjazovLy8uL3NyYy93YXhjb3JyLnRzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2NjcGhhdF8xIiwid2F4Y29ycl8xIiwiWGNvcnIiLCJbb2JqZWN0IE9iamVjdF0iLCJ0aGlzIiwicHJvY2Vzc2luZyIsIlByb2Nlc3NpbmdUeXBlIiwiV0FfWENPUlIiLCJzYW1wbGVSYXRlIiwic2V0TW9kZSIsImdjY3BoYXQiLCJHY2NwaGF0Iiwid2F4Y29yciIsIldheGNvcnIiLCJwcmV3aGl0ZW4iLCJQcmV3aGl0ZW5pbmdUeXBlIiwiTk9ORSIsImJ1ZmZlcjAiLCJidWZmZXIxIiwibGVuZ3RoIiwic2xpY2UiLCJvdXRwdXRCdWZmZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInhjb3JyIiwibm9ybWFsaXplIiwidGhlbiIsImNvcnJlbGF0ZWRCdWZmZXIiLCJjYXRjaCIsIl8iLCJjb25zb2xlIiwid2FybiIsImNvcnJlbGF0ZSIsImxvY2F0ZVBlYWtJbmRleCIsIkdDQ19QSEFUIiwiYnVmZmVyIiwibWF4IiwibWF4SW5kZXgiLCJpbmRleCIsIk1hdGgiLCJhYnMiLCJpbnRlcnBMYWciLCJpZHgiLCJpbmRleE9mTWF4Iiwic2FtcGxlTGFnIiwiZmxvb3IiLCJnZXRPZmZzZXQiLCJpbnRlcnBvbGF0ZSIsInBlYWtNMSIsInBlYWtJZHgiLCJwZWFrUDEiLCJsYWdyYW5nZVBlYWsiLCJzcXJ0IiwibWF4VmFsdWUiLCJGbG9hdDMyQXJyYXkiLCJ0ZW1wSW5kZXgiLCJ3aW5kb3ciLCJsaWJtYXRoIiwibWF0aCIsIndpbm1hdGgiLCJpbml0UHVsc2UiLCJwdWxzZSIsInNwZWN0cnVtMCIsImZvcndhcmRGRlQiLCJzcGVjdHJ1bTFDb25qIiwiY29uaiIsIm51bWVyYXRvciIsIkNvbXBsZXhEYXRhQXJyYXkxRCIsIm11bHRpcGx5IiwiZGVub21pbmF0b3IiLCJyZXN1bHQiLCJkaXZpZGUiLCJ0aW1lUmVzdWx0IiwiaW52ZXJzZUZGVCIsInJlc1hjb3JyTWF0aCIsInVuZGVmaW5lZCIsImFjdGl2ZUZGVCIsImZyZWUiLCJmZnRSZWFsIiwiZm9yd2FyZCIsInJlIiwiZXh0cmFjdFJlYWwiLCJpbSIsImV4dHJhY3RJbWFnIiwic3BlY3RydW0iLCJzZXRFbnRpcmUiLCJmcmVxdWVuY3lCdWZmZXIiLCJyZUNvdW50ZXIiLCJpbUNvdW50ZXIiLCJkYXRhIiwiaW52ZXJzZSIsImRpc3Bvc2UiLCJjb21wbGV4RnJlcUJ1ZmZlciIsIm91dHB1dCIsImNvdW50ZXIiLCJDb21wbGV4RGF0YSIsImNvbXBsZXgiLCJBcnJheSIsIm5ld0RhdGEiLCJjb25qQXJyYXkiLCJhYnNBcnJheSIsInNwZWN0cnVtMSIsIm9mZmxpbmVBdWRpbyIsIk9mZmxpbmVBdWRpb0dyYXBoIiwiZGV2aWNlQnVmZmVyMCIsImRldmljZUJ1ZmZlcjEiLCJvdXRwdXRCdWZmZXJMZW5ndGgiLCJzZXR1cEdyYXBoIiwic291cmNlMCIsInN0YXJ0Iiwib2ZmbGluZUF1ZGlvQ3R4Iiwic3RhcnRSZW5kZXJpbmciLCJjYWxjdWxhdGUiLCJjb3JyZWxhdGVkQnVmZmVyTm9kZSIsImdldENoYW5uZWxEYXRhIiwic2FtcGxpbmdSYXRlIiwicmV2ZXJzZU9mZnNldCIsImNvbnRleHQiLCJiaXF1YWQiLCJnYWluIiwiZmMiLCJRIiwic2V0VmFsdWVBdFRpbWUiLCJjdXJyZW50VGltZSIsImZyZXF1ZW5jeSIsIk9mZmxpbmVBdWRpb0NvbnRleHQiLCJjcmVhdGVCdWZmZXJTb3VyY2UiLCJzb3VyY2UxIiwiY29udm9sdmVyIiwiY3JlYXRlQ29udm9sdmVyIiwiYmlxdWFkMCIsImNyZWF0ZUJpcXVhZEZpbHRlciIsImNyZWF0ZUJ1ZmZlciIsImNvcHlUb0NoYW5uZWwiLCJyZXZlcnNlIiwiY29ubmVjdCIsImRlc3RpbmF0aW9uIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFB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LElBQUllLG9CQUFvQixFQUFHbkIsRUFBb0IsT0FHdEV2RyxLQUFLeUcsUUFBVXpHLEtBQUsyRyxnQkFBZ0JnQixxQkFDcEMzSCxLQUFLNEgsUUFBVTVILEtBQUsyRyxnQkFBZ0JnQixxQkFDcEMzSCxLQUFLNkgsVUFBWTdILEtBQUsyRyxnQkFBZ0JtQixrQkFDdEM5SCxLQUFLK0gsUUFBVS9ILEtBQUsyRyxnQkFBZ0JxQixxQkFHcENoSSxLQUFLYSxRQUFVYixLQUFLMkcsZ0JBQWdCc0IsYUFBYSxFQUFHNUIsRUFBY3RGLE9BQVFmLEtBQUtnSCxjQUMvRWhILEtBQUtjLFFBQVVkLEtBQUsyRyxnQkFBZ0JzQixhQUFhLEVBQUczQixFQUFjdkYsT0FBUWYsS0FBS2dILGNBRy9FaEgsS0FBS2EsUUFBUXFILGNBQWM3QixFQUFlLEdBQzFDckcsS0FBS2MsUUFBUW9ILGNBQWM1QixFQUFlLEdBRzFDdEcsS0FBS3lHLFFBQVF6RSxPQUFTaEMsS0FBS2EsUUFDM0JiLEtBQUs0SCxRQUFRNUYsT0FBU2hDLEtBQUtjLFFBRzNCZ0YsTUFBTXRHLFVBQVUySSxRQUFRcEssS0FBS2lDLEtBQUs0SCxRQUFRNUYsT0FBTytFLGVBQWUsSUFHaEUvRyxLQUFLaUgsY0FBZ0JqSCxLQUFLYyxRQUFRaUcsZUFBZSxHQUFHaEcsT0FBUyxFQUc3RGYsS0FBSzZILFVBQVU3RixPQUFTaEMsS0FBSzRILFFBQVE1RixPQUdyQ2hDLEtBQUt5RyxRQUFRMkIsUUFBUXBJLEtBQUs2SCxXQUMxQjdILEtBQUs2SCxVQUFVTyxRQUFRcEksS0FBSzJHLGdCQUFnQjBCIiwiZmlsZSI6ImxpYnhjb3JyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7IEdjY3BoYXQgfSBmcm9tIFwiLi9nY2NwaGF0XCI7XG5pbXBvcnQgeyBXYXhjb3JyIH0gZnJvbSAnLi93YXhjb3JyJztcblxuLyoqXG4gKiBAY2xhc3MgWGNvcnJcbiAqIEBkZXNjcmlwdGlvbiBBIHdlYiBiYXNlZCBjcm9zcy1jb3JyZWxhdGlvbiBjbGFzcy5cbiAqL1xuY2xhc3MgWGNvcnIge1xuXG4gICAgZ2NjcGhhdDogR2NjcGhhdDtcbiAgICB3YXhjb3JyOiBXYXhjb3JyO1xuICAgIHByZXdoaXRlbjogUHJld2hpdGVuaW5nVHlwZTtcbiAgICBwcm9jZXNzaW5nOiBQcm9jZXNzaW5nVHlwZSA9IFByb2Nlc3NpbmdUeXBlLldBX1hDT1JSO1xuICAgIHNhbXBsZVJhdGU6IG51bWJlciA9IDQ0MTAwO1xuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIG1vZGUgOiBDcm9zcy1jb3JyZWxhdGlvbiBtb2RlXG4gICAgICogQHBhcmFtIHByZXdoaXRlbiAgOiBTaWduYWwgcHJld2hpdGVuaW5nIG1ldGhvZFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChtb2RlOiBzdHJpbmcpIHtcblxuICAgICAgICB0aGlzLnNldE1vZGUobW9kZSk7XG5cbiAgICAgICAgdGhpcy5nY2NwaGF0ID0gbmV3IEdjY3BoYXQodGhpcy5zYW1wbGVSYXRlKTtcbiAgICAgICAgdGhpcy53YXhjb3JyID0gbmV3IFdheGNvcnIodGhpcy5zYW1wbGVSYXRlKTtcbiAgICAgICAgdGhpcy5wcmV3aGl0ZW4gPSBQcmV3aGl0ZW5pbmdUeXBlLk5PTkU7ICAgICAgICBcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY29ycmVsYXRlXG4gICAgICogQGFzeW5jXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBidWZmZXIwIDogRmlyc3QgYnVmZmVyIGZvciBjcm9zcyBjb3JyZWxhdGlvbiBcbiAgICAgKiBAcGFyYW0gYnVmZmVyMSA6IFNlY29uZGFyeSBidWZmZXIgb2YgY3Jvc3MgY29ycmVsYXRpb25cbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgY29ycmVsYXRlIChidWZmZXIwOiBGbG9hdDMyQXJyYXksIGJ1ZmZlcjE6IEZsb2F0MzJBcnJheSkge1xuXG4gICAgICAgIGlmIChidWZmZXIwLmxlbmd0aCAhPSBidWZmZXIxLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGJ1ZmZlcjAubGVuZ3RoID4gYnVmZmVyMS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBidWZmZXIwID0gYnVmZmVyMC5zbGljZSgwLCBidWZmZXIxLmxlbmd0aCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJ1ZmZlcjEgPSBidWZmZXIxLnNsaWNlKDAsIGJ1ZmZlcjEubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAodGhpcy5wcmV3aGl0ZW4pIHtcbiAgICAgICAgICAgIGNhc2UgKFByZXdoaXRlbmluZ1R5cGUuTk9ORSk6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIChQcmV3aGl0ZW5pbmdUeXBlLk1FQU5fUkVNT1ZBTCk6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIChQcmV3aGl0ZW5pbmdUeXBlLlRSRU5EX1JFTU9WQUwpOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG91dHB1dEJ1ZmZlcjogRmxvYXQzMkFycmF5O1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMucHJvY2Vzc2luZykge1xuICAgICAgICAgICAgICAgIGNhc2UgKFByb2Nlc3NpbmdUeXBlLkdDQ19QSEFUKTpcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0QnVmZmVyID0gdGhpcy5nY2NwaGF0Lnhjb3JyKGJ1ZmZlcjAsIGJ1ZmZlcjEpO1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXRCdWZmZXIgPSBYY29yci5ub3JtYWxpemUob3V0cHV0QnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvdXRwdXRCdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIChQcm9jZXNzaW5nVHlwZS5XQV9YQ09SUik6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud2F4Y29yci54Y29ycihidWZmZXIwLCBidWZmZXIxKS50aGVuKChjb3JyZWxhdGVkQnVmZmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWxhdGVkQnVmZmVyID0gWGNvcnIubm9ybWFsaXplKDxGbG9hdDMyQXJyYXk+Y29ycmVsYXRlZEJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGNvcnJlbGF0ZWRCdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChfID0+IGNvbnNvbGUud2FybignV2FybmluZyBXYXhjb3JyIGZhaWxlZCwgb2ZmbGluZUF1ZGlvQ29udGV4dCBub3Qgc2V0dXAuJykpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRCdWZmZXIgPSB0aGlzLmdjY3BoYXQueGNvcnIoYnVmZmVyMCwgYnVmZmVyMSk7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dEJ1ZmZlciA9IFhjb3JyLm5vcm1hbGl6ZShvdXRwdXRCdWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG91dHB1dEJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHRpbWVMYWdcbiAgICAgKiBAYXN5bmNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGJ1ZmZlcjAgOiBGaXJzdCBidWZmZXIgZm9yIGNyb3NzIGNvcnJlbGF0aW9uIFxuICAgICAqIEBwYXJhbSBidWZmZXIxIDogU2Vjb25kYXJ5IGJ1ZmZlciBvZiBjcm9zcyBjb3JyZWxhdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyB0aW1lTGFnIChidWZmZXIwOiBGbG9hdDMyQXJyYXksIGJ1ZmZlcjE6IEZsb2F0MzJBcnJheSkge1xuXG4gICAgICAgIGNvbnN0IGNvcnJlbGF0ZWRCdWZmZXIgPSBhd2FpdCB0aGlzLmNvcnJlbGF0ZShidWZmZXIwLCBidWZmZXIxKTtcbiAgICAgICAgbGV0IGxhZyA9IHRoaXMubG9jYXRlUGVha0luZGV4KDxGbG9hdDMyQXJyYXk+Y29ycmVsYXRlZEJ1ZmZlcik7XG4gICAgXG4gICAgICAgIHJldHVybiBsYWc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBtZXRob2RcbiAgICAgKiBAcGFyYW0gbW9kZSA6IE5ldyBwcm9jZXNzaW5nIG1vZGUgdG8gdXNlIGZvciBjcm9zcy1jb3JyZWxhdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBzZXRNb2RlIChtb2RlOiBzdHJpbmcpOiB2b2lkIHtcblxuICAgICAgICBzd2l0Y2ggKG1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgKCd3YXhjb3JyJyk6XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzaW5nID0gUHJvY2Vzc2luZ1R5cGUuV0FfWENPUlI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKCdnY2NwaGF0Jyk6XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzaW5nID0gUHJvY2Vzc2luZ1R5cGUuR0NDX1BIQVQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGluZGV4T2ZNYXhcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gYnVmZmVyIDogQnVmZmVyIHRvIGNhbGN1bGF0ZSBtYXhpbXVtIGluZGV4IG9mXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5kZXhPZk1heCAoYnVmZmVyOiBGbG9hdDMyQXJyYXkpOiBudW1iZXIge1xuXG4gICAgICAgIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbWF4ID0gYnVmZmVyWzBdO1xuICAgICAgICBsZXQgbWF4SW5kZXggPSAwO1xuXG4gICAgICAgIGZvciAodmFyIGluZGV4ID0gMTsgaW5kZXggPCBidWZmZXIubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBpZiAoYnVmZmVyW2luZGV4XSA+IG1heCkge1xuICAgICAgICAgICAgICAgIG1heEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgbWF4ID0gTWF0aC5hYnMoYnVmZmVyW2luZGV4XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWF4SW5kZXg7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGxvY2F0ZVBlYWtJbmRleFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIGJ1ZmZlciA6IEJ1ZmZlciB0byBsb2NhdGUgdGhlIHBlYWsgaW5kZXhcbiAgICAgKi9cbiAgICBwcml2YXRlIGxvY2F0ZVBlYWtJbmRleCAoYnVmZmVyOiBGbG9hdDMyQXJyYXkpOiBudW1iZXIge1xuXG4gICAgICAgIGxldCBpZHg6IG51bWJlciA9IFhjb3JyLmluZGV4T2ZNYXgoYnVmZmVyKTtcblxuICAgICAgICBsZXQgc2FtcGxlTGFnID0gMDtcblxuICAgICAgICBpZiAodGhpcy5wcm9jZXNzaW5nID09PSBQcm9jZXNzaW5nVHlwZS5HQ0NfUEhBVCkge1xuICAgICAgICAgICAgaWYgKGlkeCA+IE1hdGguZmxvb3IoYnVmZmVyLmxlbmd0aC8yKSkge1xuICAgICAgICAgICAgICAgIHNhbXBsZUxhZyA9IGJ1ZmZlci5sZW5ndGggLSBpZHg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNhbXBsZUxhZyA9IGlkeDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNhbXBsZUxhZyA9IGlkeCAtIHRoaXMud2F4Y29yci5nZXRPZmZzZXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpbnRlcnBMYWc6IG51bWJlcjtcblxuICAgICAgICBpZiAoc2FtcGxlTGFnID4gMSkge1xuICAgICAgICAgICAgaW50ZXJwTGFnID0gWGNvcnIuaW50ZXJwb2xhdGUoYnVmZmVyW3NhbXBsZUxhZy0xXSwgYnVmZmVyW3NhbXBsZUxhZ10sIGJ1ZmZlcltzYW1wbGVMYWcrMV0pO1xuICAgICAgICAgICAgaW50ZXJwTGFnICs9IHNhbXBsZUxhZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGludGVycExhZyA9IE1hdGguYWJzKHNhbXBsZUxhZyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW50ZXJwTGFnO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBpbnRlcnBvbGF0ZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBwZWFrTTEgOiBJbmRleCBiZWZvcmUgcGVhayBpbmRleFxuICAgICAqIEBwYXJhbSBwZWFrSWR4IDogUGVhayBpbmRleFxuICAgICAqIEBwYXJhbSBwZWFrUDEgOiBJbmRleCBhZnRlciBwZWFrIGluZGV4XG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgaW50ZXJwb2xhdGUgKHBlYWtNMTogbnVtYmVyLCBwZWFrSWR4OiBudW1iZXIsIHBlYWtQMTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgXG4gICAgICAgIGxldCBsYWdyYW5nZVBlYWsgPSAwLjUgKiAocGVha00xIC0gcGVha1AxKSAvIChwZWFrTTEgLSAoMipwZWFrSWR4KSArIHBlYWtQMSk7XG5cbiAgICAgICAgbGV0IGJpYXNDb3JyZWN0ZWQgPSAoTWF0aC5zcXJ0KDMyICogKGxhZ3JhbmdlUGVhaypsYWdyYW5nZVBlYWspICsgMSkgLSAxKSAvICg4ICogbGFncmFuZ2VQZWFrKTtcblxuICAgICAgICByZXR1cm4gYmlhc0NvcnJlY3RlZDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgbm9ybWFsaXplXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIGJ1ZmZlciA6IEJ1ZmZlciB0byBub3JtYWxpemVcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBub3JtYWxpemUgKGJ1ZmZlcjogRmxvYXQzMkFycmF5KTogRmxvYXQzMkFycmF5IHtcblxuICAgICAgICBsZXQgbWF4VmFsdWUgPSAwO1xuICAgICAgICBsZXQgb3V0cHV0QnVmZmVyOiBGbG9hdDMyQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KGJ1ZmZlci5sZW5ndGgpO1xuXG4gICAgICAgIGZvciAobGV0IHRlbXBJbmRleCA9IDA7IHRlbXBJbmRleCA8IGJ1ZmZlci5sZW5ndGg7IHRlbXBJbmRleCsrKSB7XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnMoYnVmZmVyW3RlbXBJbmRleF0pID4gbWF4VmFsdWUpe1xuICAgICAgICAgICAgICAgIG1heFZhbHVlID0gTWF0aC5hYnMoYnVmZmVyW3RlbXBJbmRleF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGJ1ZmZlci5sZW5ndGg7IGluZGV4Kyspe1xuICAgICAgICAgICAgb3V0cHV0QnVmZmVyW2luZGV4XSA9IGJ1ZmZlcltpbmRleF0vbWF4VmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3V0cHV0QnVmZmVyO1xuXG4gICAgfVxuXG59XG5cbi8qKlxuICogQGVudW0gUHJvY2Vzc2luZ1R5cGVcbiAqL1xuZW51bSBQcm9jZXNzaW5nVHlwZSB7XG4gICAgV0FfWENPUlIgPSAnd2F4Y29ycicsXG4gICAgR0NDX1BIQVQgPSAnZ2NjcGhhdCdcbn07XG5cbi8qKlxuICogQGVudW0gUHJld2hpdGVuaW5nVHlwZVxuICovXG5lbnVtIFByZXdoaXRlbmluZ1R5cGUge1xuICAgIE5PTkUsXG4gICAgTUVBTl9SRU1PVkFMLFxuICAgIFRSRU5EX1JFTU9WQUxcbn1cblxuLy8gQXBwbHkgdG8gd2luZG93IGZvciBlYXN5IEpTIGNhbGxzXG4oPGFueT53aW5kb3cpLnhjb3JyID0gbmV3IFhjb3JyKFByb2Nlc3NpbmdUeXBlLldBX1hDT1JSKTsiLCIvKipcbiAqIEBjbGFzcyBHY2NwaGF0XG4gKi9cbmV4cG9ydCBjbGFzcyBHY2NwaGF0IHtcblxuICAgIGxpYm1hdGg6IGFueTtcbiAgICB3aW5tYXRoOiBhbnk7XG4gICAgcHVsc2U6IGFueTtcbiAgICBhY3RpdmVGRlQ6IGFueTtcbiAgICBzYW1wbGVSYXRlOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gc2FtcGxlUmF0ZSA6IFNhbXBsZSByYXRlIG9mIGRldmljZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChzYW1wbGVSYXRlOiBudW1iZXIpIHtcblxuICAgICAgICB0aGlzLnNhbXBsZVJhdGUgPSBzYW1wbGVSYXRlO1xuICAgICAgICB0aGlzLmxpYm1hdGggPSAoPGFueT53aW5kb3cpLm1hdGg7XG4gICAgICAgIHRoaXMud2lubWF0aCA9ICg8YW55PndpbmRvdykuTWF0aDtcblxuICAgICAgICBpZiAoKDxhbnk+d2luZG93KS5pbml0UHVsc2UgfHwgKDxhbnk+d2luZG93KS5tYXRoKSB7XG4gICAgICAgICAgICAoPGFueT53aW5kb3cpLmluaXRQdWxzZSgpLnRoZW4oKHB1bHNlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnB1bHNlID0gcHVsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignR0NDLVBIQVQgd2FzIG5vdCBzZXR1cCBjb3JyZWN0bHkhJyk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgeGNvcnJcbiAgICAgKiBAYXN5bmNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGJ1ZmZlcjAgOiBGaXJzdCBidWZmZXIgdG8gY3Jvc3MgY29ycmVsYXRlXG4gICAgICogQHBhcmFtIGJ1ZmZlcjEgOiBTZWNvbmQgYnVmZmVyIHRvIGNyb3NzIGNvcnJlbGF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyB4Y29yciAoYnVmZmVyMDogRmxvYXQzMkFycmF5LCBidWZmZXIxOiBGbG9hdDMyQXJyYXkpIHtcblxuICAgICAgICAvLyBDb252ZXJ0IGJvdGggdG8gZnJlcXVlbmN5IGRvbWFpblxuICAgICAgICB2YXIgc3BlY3RydW0wID0gdGhpcy5mb3J3YXJkRkZUKGJ1ZmZlcjApO1xuICAgICAgICB2YXIgc3BlY3RydW0xID0gdGhpcy5mb3J3YXJkRkZUKGJ1ZmZlcjEpO1xuXG4gICAgICAgIC8vIENvbXBsZXggY29uanVnYXRlIFxuICAgICAgICB2YXIgc3BlY3RydW0xQ29uaiA9IHNwZWN0cnVtMS5jb25qKCk7XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIG51bWVyYXRvclxuICAgICAgICB2YXIgbnVtZXJhdG9yID0gQ29tcGxleERhdGFBcnJheTFELm11bHRpcGx5KHNwZWN0cnVtMCwgc3BlY3RydW0xQ29uaik7XG5cbiAgICAgICAgLy8gQWJzb2x1dGUgb2YgdGhlIG51bWVyYXRvclxuICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBudW1lcmF0b3IuYWJzKCk7XG5cbiAgICAgICAgLy8gRGl2aWRlIHRoZSByZXN1bHRzXG4gICAgICAgIHZhciByZXN1bHQgPSBDb21wbGV4RGF0YUFycmF5MUQuZGl2aWRlKG51bWVyYXRvciwgZGVub21pbmF0b3IpO1xuXG4gICAgICAgIC8vIENvbnZlcnQgdG8gdGltZSBkb21haW5cbiAgICAgICAgdmFyIHRpbWVSZXN1bHQgPSB0aGlzLmludmVyc2VGRlQocmVzdWx0KTtcbiAgICAgICAgXG4gICAgICAgICg8YW55PndpbmRvdykucmVzWGNvcnJNYXRoID0gdGltZVJlc3VsdDtcblxuICAgICAgICByZXR1cm4gdGltZVJlc3VsdDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZm9yd2FyZEZGVFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIGJ1ZmZlciA6IEJ1ZmZlciB0byB0cmFuc2Zvcm1cbiAgICAgKi9cbiAgICBwcml2YXRlIGZvcndhcmRGRlQgKGJ1ZmZlcjogRmxvYXQzMkFycmF5KTogQ29tcGxleERhdGFBcnJheTFEIHtcblxuICAgICAgICBpZiAodGhpcy5hY3RpdmVGRlQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mcmVlKCk7XG4gICAgICAgIH0gXG5cbiAgICAgICAgdGhpcy5hY3RpdmVGRlQgPSBuZXcgdGhpcy5wdWxzZS5mZnRSZWFsKGJ1ZmZlci5sZW5ndGgpO1xuICAgICAgICBcbiAgICAgICAgdmFyIHJlc3VsdDogRmxvYXQzMkFycmF5ID0gdGhpcy5hY3RpdmVGRlQuZm9yd2FyZChidWZmZXIpO1xuXG4gICAgICAgIGxldCByZSA9IHRoaXMuZXh0cmFjdFJlYWwocmVzdWx0KTtcbiAgICAgICAgbGV0IGltID0gdGhpcy5leHRyYWN0SW1hZyhyZXN1bHQpO1xuXG4gICAgICAgIGxldCBzcGVjdHJ1bSA9IG5ldyBDb21wbGV4RGF0YUFycmF5MUQocmVzdWx0Lmxlbmd0aCk7XG4gICAgICAgIHNwZWN0cnVtLnNldEVudGlyZShyZSwgaW0pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHNwZWN0cnVtO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaW52ZXJzZUZGVFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHNwZWN0cnVtIDogQ29tcGxleCBkYXRhIGFycmF5IHRvIGludmVyc2UgdHJhbnNmb3JtXG4gICAgICovXG4gICAgcHJpdmF0ZSBpbnZlcnNlRkZUIChzcGVjdHJ1bTogQ29tcGxleERhdGFBcnJheTFEKTogRmxvYXQzMkFycmF5IHtcblxuICAgICAgICBsZXQgZnJlcXVlbmN5QnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheShzcGVjdHJ1bS5sZW5ndGggKiAyKTtcblxuICAgICAgICBsZXQgcmVDb3VudGVyID0gMDtcbiAgICAgICAgbGV0IGltQ291bnRlciA9IDA7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZnJlcXVlbmN5QnVmZmVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgaWYgKGluZGV4JTIgPT09IDApIHtcbiAgICAgICAgICAgICAgICBmcmVxdWVuY3lCdWZmZXJbaW5kZXhdID0gc3BlY3RydW0uZGF0YVtyZUNvdW50ZXJdLnJlO1xuICAgICAgICAgICAgICAgIHJlQ291bnRlcisrXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZyZXF1ZW5jeUJ1ZmZlcltpbmRleF0gPSBzcGVjdHJ1bS5kYXRhW2ltQ291bnRlcl0uaW07XG4gICAgICAgICAgICAgICAgaW1Db3VudGVyKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheShmcmVxdWVuY3lCdWZmZXIubGVuZ3RoKTtcblxuICAgICAgICBpZiAodGhpcy5hY3RpdmVGRlQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5hY3RpdmVGRlQuaW52ZXJzZShmcmVxdWVuY3lCdWZmZXIpO1xuICAgICAgICAgICAgdGhpcy5mcmVlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFcnJvciBhY3RpdmVGRlQgbm90IGRlZmluZWQgb24gR0NDLVBIQVQgaGFuZGxlciFcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmcmVlXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcml2YXRlIGZyZWUgKCkge1xuICAgICAgICB0aGlzLmFjdGl2ZUZGVC5kaXNwb3NlKCk7XG4gICAgICAgIHRoaXMuYWN0aXZlRkZUID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZXh0cmFjdFJlYWxcbiAgICAgKiBAcHJpdmF0ZSBcbiAgICAgKiBAcGFyYW0gY29tcGxleEZyZXFCdWZmZXIgOiBGcmVxdWVuY3kgYnVmZmVyIHJldHVybmVkIGZyb20gcHVsc2VGRlRcbiAgICAgKi9cbiAgICBwcml2YXRlIGV4dHJhY3RSZWFsIChjb21wbGV4RnJlcUJ1ZmZlcjogRmxvYXQzMkFycmF5KSB7XG5cbiAgICAgICAgaWYgKGNvbXBsZXhGcmVxQnVmZmVyLmxlbmd0aCUyICE9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBvdXRwdXQ6IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy53aW5tYXRoLmZsb29yKGNvbXBsZXhGcmVxQnVmZmVyLmxlbmd0aC8yKSk7XG4gICAgICAgIGxldCBjb3VudGVyOiBudW1iZXIgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjb21wbGV4RnJlcUJ1ZmZlci5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGlmICgoaW5kZXggJSAyKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIG91dHB1dFtjb3VudGVyXSA9IGNvbXBsZXhGcmVxQnVmZmVyW2luZGV4XTtcbiAgICAgICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZXh0cmFjdEltYWdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBjb21wbGV4RnJlcUJ1ZmZlciA6IEZyZXF1ZW5jeSBidWZmZXIgcmV0dXJuZWQgZnJvbSBwdWxzZUZGVFxuICAgICAqL1xuICAgIHByaXZhdGUgZXh0cmFjdEltYWcgKGNvbXBsZXhGcmVxQnVmZmVyOiBGbG9hdDMyQXJyYXkpIHtcblxuICAgICAgICBpZiAoY29tcGxleEZyZXFCdWZmZXIubGVuZ3RoJTIgIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQzMkFycmF5KDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG91dHB1dDogRmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLndpbm1hdGguZmxvb3IoY29tcGxleEZyZXFCdWZmZXIubGVuZ3RoLzIpKTtcbiAgICAgICAgbGV0IGNvdW50ZXI6IG51bWJlciA9IDA7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNvbXBsZXhGcmVxQnVmZmVyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgaWYgKChpbmRleCAlIDIpICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0W2NvdW50ZXJdID0gY29tcGxleEZyZXFCdWZmZXJbaW5kZXhdO1xuICAgICAgICAgICAgICAgIGNvdW50ZXIrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuXG59XG5cbi8qKlxuICogQGNsYXNzIENvbXBsZXhEYXRhXG4gKi9cbmNsYXNzIENvbXBsZXhEYXRhIHtcblxuICAgIGRhdGE6IE9iamVjdDtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSByZSA6IFJlYWwgbnVtYmVyIG9mIHRoZSBkYXRhXG4gICAgICogQHBhcmFtIGltIDogSW1hZ2luYXJ5IG51bWJlciBvZiB0aGUgZGF0YVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChyZTogbnVtYmVyLCBpbTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9ICg8YW55PndpbmRvdykubWF0aC5jb21wbGV4KHJlLCBpbSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBpbnRlcmZhY2UgQ29tcGxleERhdGFcbiAqL1xuaW50ZXJmYWNlIENvbXBsZXhEYXRhIHtcbiAgICBkYXRhOiBPYmplY3Q7XG4gICAgcmU6IG51bWJlcjtcbiAgICBpbTogbnVtYmVyO1xufVxuXG4vKipcbiAqIEBjbGFzcyBDb21wbGV4RGF0YUFycmF5MURcbiAqL1xuY2xhc3MgQ29tcGxleERhdGFBcnJheTFEIHtcblxuICAgIGRhdGE6IENvbXBsZXhEYXRhW107XG4gICAgbGVuZ3RoOiBudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gbGVuZ3RoIDogTGVuZ3RoIG9mIHRoZSBhcnJheVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChsZW5ndGg6IG51bWJlcikge1xuXG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgICAgICB0aGlzLmRhdGEgPSBuZXcgQXJyYXkobGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGFbaW5kZXhdID0gbmV3IENvbXBsZXhEYXRhKDAsMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldEVudGlyZVxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gcmUgOiBBbiBhcnJheSBvZiAzMiBiaXQgZmxvYXRzIG9mIHJlYWwgbnVtYmVyc1xuICAgICAqIEBwYXJhbSBpbSA6IEFuIGFycmF5IG9mIDMyIGJpdCBmbG9hdHMgb2YgaW1hZ2luYXJ5IG51bWJlcnNcbiAgICAgKi9cbiAgICBwdWJsaWMgc2V0RW50aXJlIChyZTogRmxvYXQzMkFycmF5LCBpbTogRmxvYXQzMkFycmF5KSB7XG5cbiAgICAgICAgbGV0IG5ld0RhdGEgPSBuZXcgQXJyYXkocmUubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcmUubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICBuZXdEYXRhW2luZGV4XSA9ICg8YW55PndpbmRvdykubWF0aC5jb21wbGV4KHJlW2luZGV4XSwgaW1baW5kZXhdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZGF0YSA9IG5ld0RhdGE7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5kYXRhLmxlbmd0aDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNvbmpcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIGNvbmogKCkgOiBDb21wbGV4RGF0YUFycmF5MUQge1xuXG4gICAgICAgIGxldCBjb25qQXJyYXkgPSBuZXcgQ29tcGxleERhdGFBcnJheTFEKHRoaXMubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGNvbmpBcnJheS5kYXRhW2luZGV4XSA9ICg8YW55PndpbmRvdykubWF0aC5jb25qKHRoaXMuZGF0YVtpbmRleF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbmpBcnJheTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGFic1xuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgYWJzICgpIDogQ29tcGxleERhdGFBcnJheTFEIHtcblxuICAgICAgICBsZXQgYWJzQXJyYXkgPSBuZXcgQ29tcGxleERhdGFBcnJheTFEKHRoaXMubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIGFic0FycmF5LmRhdGFbaW5kZXhdID0gKDxhbnk+d2luZG93KS5tYXRoLmFicyh0aGlzLmRhdGFbaW5kZXhdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhYnNBcnJheTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG11bHRpcGx5XG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBzcGVjdHJ1bTAgOiBDb21wbGV4IGRhdGEgdG8gYmUgbXVsdGlwbGllZFxuICAgICAqIEBwYXJhbSBzcGVjdHJ1bTEgOiBDb21wbGV4IGRhdGEgdG8gYmUgbXVsdGlwbGllZFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbXVsdGlwbHkgKHNwZWN0cnVtMDogQ29tcGxleERhdGFBcnJheTFELCBzcGVjdHJ1bTE6IENvbXBsZXhEYXRhQXJyYXkxRCkgOiBDb21wbGV4RGF0YUFycmF5MUQge1xuXG4gICAgICAgIGxldCByZXN1bHQgPSBuZXcgQ29tcGxleERhdGFBcnJheTFEKHNwZWN0cnVtMC5sZW5ndGgpO1xuXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzcGVjdHJ1bTAubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAoPGFueT53aW5kb3cpLm1hdGgubXVsdGlwbHkoc3BlY3RydW0wLmRhdGFbaW5kZXhdLCBzcGVjdHJ1bTEuZGF0YVtpbmRleF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGRpdmlkZVxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gc3BlY3RydW0wIDogQ29tcGxleCBkYXRhIHRvIGJlIGRpdmlkZWRcbiAgICAgKiBAcGFyYW0gc3BlY3RydW0xIDogQ29tcGxleCBkYXRhIHRvIGJlIGRpdmlkZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGRpdmlkZSAoc3BlY3RydW0wOiBDb21wbGV4RGF0YUFycmF5MUQsIHNwZWN0cnVtMTogQ29tcGxleERhdGFBcnJheTFEKSA6IENvbXBsZXhEYXRhQXJyYXkxRCB7XG5cbiAgICAgICAgbGV0IHJlc3VsdCA9IG5ldyBDb21wbGV4RGF0YUFycmF5MUQoc3BlY3RydW0wLmxlbmd0aCk7XG5cbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNwZWN0cnVtMC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9ICg8YW55PndpbmRvdykubWF0aC5kaXZpZGUoc3BlY3RydW0wLmRhdGFbaW5kZXhdLCBzcGVjdHJ1bTEuZGF0YVtpbmRleF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbn1cblxuLyoqXG4gKiBAaW50ZXJmYWNlIE9iamVjdFxuICovXG5pbnRlcmZhY2UgT2JqZWN0IHtcbiAgICByZTogbnVtYmVyO1xuICAgIGltOiBudW1iZXI7XG59XG4iLCJcbi8qKlxuICogQGNsYXNzIFdheGNvcnJcbiAqL1xuZXhwb3J0IGNsYXNzIFdheGNvcnIge1xuXG4gICAgb2ZmbGluZUF1ZGlvOiBPZmZsaW5lQXVkaW9HcmFwaDtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBzYW1wbGVSYXRlIDogU2FtcGxpbmcgcmF0ZSBvZiBvZmZsaW5lIGF1ZGlvIGNvbnRleHQgcHJvY2Vzc2luZ1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChzYW1wbGVSYXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW8gPSBuZXcgT2ZmbGluZUF1ZGlvR3JhcGgoc2FtcGxlUmF0ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBjYWxjdWxhdGVcbiAgICAgKiBAYXN5bmNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIwIDogQXVkaW8gYnVmZmVyIHRvIGNyb3NzIGNvcnJlbGF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIxIDogU2Vjb25kIGF1ZGlvIGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKiBAcGFyYW0gb3V0cHV0QnVmZmVyTGVuZ3RoIDogT3V0cHV0IGF1ZGlvIGJ1ZmZlciBsZW5ndGggZXhwZWN0ZWRcbiAgICAgKi9cbiAgICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZSAoZGV2aWNlQnVmZmVyMDogRmxvYXQzMkFycmF5LCBkZXZpY2VCdWZmZXIxOiBGbG9hdDMyQXJyYXksIG91dHB1dEJ1ZmZlckxlbmd0aDogbnVtYmVyKSB7XG5cbiAgICAgICAgLy8gU2V0dXAgYXVkaW8gZ3JhcGggYmVmb3JlIGNvcnJlbGF0aW9uXG4gICAgICAgIHRoaXMub2ZmbGluZUF1ZGlvLnNldHVwR3JhcGgoZGV2aWNlQnVmZmVyMCwgZGV2aWNlQnVmZmVyMSwgb3V0cHV0QnVmZmVyTGVuZ3RoKTtcblxuICAgICAgICAvLyBTdGFydCBidWZmZXIgcGxheWluZ1xuICAgICAgICBpZiAodGhpcy5vZmZsaW5lQXVkaW8uc291cmNlMCkge1xuICAgICAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW8uc291cmNlMC5zdGFydCgpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vZmZsaW5lQXVkaW8ub2ZmbGluZUF1ZGlvQ3R4KSB7XG4gICAgICAgICAgICAvLyBXYWl0IGZvciBjb250ZXh0IHRvIGNvbXBsZXRlXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZsaW5lQXVkaW8ub2ZmbGluZUF1ZGlvQ3R4LnN0YXJ0UmVuZGVyaW5nKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB4Y29yclxuICAgICAqIEBhc3luY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gYnVmZmVyMCA6IEZpcnN0IGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKiBAcGFyYW0gYnVmZmVyMSA6IFNlY29uZCBidWZmZXIgdG8gY3Jvc3MgY29ycmVsYXRlXG4gICAgICovXG4gICAgcHVibGljIGFzeW5jIHhjb3JyIChidWZmZXIwOiBGbG9hdDMyQXJyYXksIGJ1ZmZlcjE6IEZsb2F0MzJBcnJheSkge1xuICAgICAgICBsZXQgb3V0cHV0QnVmZmVyTGVuZ3RoID0gYnVmZmVyMC5sZW5ndGggKyBidWZmZXIxLmxlbmd0aCAtIDE7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZShidWZmZXIwLCBidWZmZXIxLCBvdXRwdXRCdWZmZXJMZW5ndGgpLnRoZW4oKGNvcnJlbGF0ZWRCdWZmZXJOb2RlKT0+e1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKDxBdWRpb0J1ZmZlcj5jb3JyZWxhdGVkQnVmZmVyTm9kZSkuZ2V0Q2hhbm5lbERhdGEoMCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0T2Zmc2V0XG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBnZXRPZmZzZXQgKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLm9mZmxpbmVBdWRpby5nZXRPZmZzZXQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGNsYXNzIE9mZmxpbmVBdWRpb0dyYXBoXG4gKi9cbmNsYXNzIE9mZmxpbmVBdWRpb0dyYXBoIHtcblxuICAgIG9mZmxpbmVBdWRpb0N0eD86IE9mZmxpbmVBdWRpb0NvbnRleHQ7XG4gICAgcmV2ZXJzZU9mZnNldDogbnVtYmVyID0gMDtcbiAgICBjb252b2x2ZXI/OiBDb252b2x2ZXJOb2RlO1xuICAgIHNvdXJjZTA/OiBBdWRpb0J1ZmZlclNvdXJjZU5vZGU7XG4gICAgc291cmNlMT86IEF1ZGlvQnVmZmVyU291cmNlTm9kZTtcbiAgICBidWZmZXIwPzogQXVkaW9CdWZmZXI7XG4gICAgYnVmZmVyMT86IEF1ZGlvQnVmZmVyO1xuICAgIGJpcXVhZDA/OiBCaXF1YWRGaWx0ZXJOb2RlO1xuICAgIHNhbXBsaW5nUmF0ZTogbnVtYmVyID0gNDQxMDA7XG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gc2FtcGxpbmdSYXRlIDogU2FtcGxpbmcgcmF0ZSBvZiBvZmZsaW5lIGF1ZGlvIGNvbnRleHRcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoc2FtcGxpbmdSYXRlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zYW1wbGluZ1JhdGUgPSBzYW1wbGluZ1JhdGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBnZXRPZmZzZXRcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIGdldE9mZnNldCAoKSA6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnJldmVyc2VPZmZzZXQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRCaXF1YWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBjb250ZXh0IDogT2ZmbGluZSBhdWRpbyBjb250ZXh0XG4gICAgICogQHBhcmFtIGJpcXVhZCA6IEJpcXVhZEZpbHRlck5vZGUgb2JqZWN0IHJlZmVyZW5jZVxuICAgICAqIEBwYXJhbSBnYWluIDogR2FpbiBvZiBmaWx0ZXIgdG8gc2V0XG4gICAgICogQHBhcmFtIGZjIDogQ3V0b2ZmIGZyZXF1ZW5jeSB0byBzZXRcbiAgICAgKiBAcGFyYW0gUSA6IFEtZmFjdG9yIHRvIHNldFxuICAgICAqL1xuICAgIHByaXZhdGUgc2V0QmlxdWFkIChjb250ZXh0OiBPZmZsaW5lQXVkaW9Db250ZXh0LCBiaXF1YWQ6IEJpcXVhZEZpbHRlck5vZGUsIGdhaW46IG51bWJlciwgZmM6IG51bWJlciwgUTogbnVtYmVyKTogdm9pZCB7XG5cbiAgICAgICAgYmlxdWFkLmdhaW4uc2V0VmFsdWVBdFRpbWUoZ2FpbiwgY29udGV4dC5jdXJyZW50VGltZSk7XG5cbiAgICAgICAgYmlxdWFkLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZShmYywgY29udGV4dC5jdXJyZW50VGltZSk7XG4gICAgICAgIFxuICAgICAgICBiaXF1YWQuUS5zZXRWYWx1ZUF0VGltZShRLCBjb250ZXh0LmN1cnJlbnRUaW1lKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZnJlZVxuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgZnJlZSAoKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXR1cEdyYXBoXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIwIDogQXVkaW8gYnVmZmVyIHRvIGNyb3NzIGNvcnJlbGF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VCdWZmZXIxIDogU2Vjb25kIGF1ZGlvIGJ1ZmZlciB0byBjcm9zcyBjb3JyZWxhdGVcbiAgICAgKiBAcGFyYW0gb3V0cHV0QnVmZmVyTGVuZ3RoIDogT3V0cHV0IGF1ZGlvIGJ1ZmZlciBsZW5ndGggZXhwZWN0ZWRcbiAgICAgKi9cbiAgICBwdWJsaWMgc2V0dXBHcmFwaCAoZGV2aWNlQnVmZmVyMDogRmxvYXQzMkFycmF5LCBkZXZpY2VCdWZmZXIxOiBGbG9hdDMyQXJyYXksIG91dHB1dEJ1ZmZlckxlbmd0aDogbnVtYmVyKTogdm9pZCB7XG5cbiAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW9DdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dCgxLCBvdXRwdXRCdWZmZXJMZW5ndGgsIDQ0MTAwKTtcblxuICAgICAgICAvLyBDcmVhdGUgbm9kZXNcbiAgICAgICAgdGhpcy5zb3VyY2UwID0gdGhpcy5vZmZsaW5lQXVkaW9DdHguY3JlYXRlQnVmZmVyU291cmNlKCk7XG4gICAgICAgIHRoaXMuc291cmNlMSA9IHRoaXMub2ZmbGluZUF1ZGlvQ3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgICB0aGlzLmNvbnZvbHZlciA9IHRoaXMub2ZmbGluZUF1ZGlvQ3R4LmNyZWF0ZUNvbnZvbHZlcigpO1xuICAgICAgICB0aGlzLmJpcXVhZDAgPSB0aGlzLm9mZmxpbmVBdWRpb0N0eC5jcmVhdGVCaXF1YWRGaWx0ZXIoKTtcblxuICAgICAgICAvLyBDcmVhdGUgYXVkaW8gYnVmZmVyc1xuICAgICAgICB0aGlzLmJ1ZmZlcjAgPSB0aGlzLm9mZmxpbmVBdWRpb0N0eC5jcmVhdGVCdWZmZXIoMSwgZGV2aWNlQnVmZmVyMC5sZW5ndGgsIHRoaXMuc2FtcGxpbmdSYXRlKTtcbiAgICAgICAgdGhpcy5idWZmZXIxID0gdGhpcy5vZmZsaW5lQXVkaW9DdHguY3JlYXRlQnVmZmVyKDEsIGRldmljZUJ1ZmZlcjEubGVuZ3RoLCB0aGlzLnNhbXBsaW5nUmF0ZSk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBhdWRpbyBidWZmZXJzXG4gICAgICAgIHRoaXMuYnVmZmVyMC5jb3B5VG9DaGFubmVsKGRldmljZUJ1ZmZlcjAsIDApO1xuICAgICAgICB0aGlzLmJ1ZmZlcjEuY29weVRvQ2hhbm5lbChkZXZpY2VCdWZmZXIxLCAwKTtcblxuICAgICAgICAvLyBTZXQgdGhlIGJ1ZmZlciBub2RlcyB0byB0aGUgbmV3IGF1ZGlvIGJ1ZmZlcnNcbiAgICAgICAgdGhpcy5zb3VyY2UwLmJ1ZmZlciA9IHRoaXMuYnVmZmVyMDtcbiAgICAgICAgdGhpcy5zb3VyY2UxLmJ1ZmZlciA9IHRoaXMuYnVmZmVyMTtcblxuICAgICAgICAvLyBSZXZlcnNlIHNlY29uZCBidWZmZXJcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLnJldmVyc2UuY2FsbCh0aGlzLnNvdXJjZTEuYnVmZmVyLmdldENoYW5uZWxEYXRhKDApKTtcblxuICAgICAgICAvLyBTdG9yZSB0aGUgcmV2ZXJzZSBvZmZzZXQgXG4gICAgICAgIHRoaXMucmV2ZXJzZU9mZnNldCA9IHRoaXMuYnVmZmVyMS5nZXRDaGFubmVsRGF0YSgwKS5sZW5ndGggLSAxO1xuXG4gICAgICAgIC8vIFNldCB0aGUgY29udm9sdXRpb24gYnVmZmVyXG4gICAgICAgIHRoaXMuY29udm9sdmVyLmJ1ZmZlciA9IHRoaXMuc291cmNlMS5idWZmZXI7XG5cbiAgICAgICAgLy8gQ29ubmVjdCB1cCBwcm9jZXNzaW5nIGdyYXBoXG4gICAgICAgIHRoaXMuc291cmNlMC5jb25uZWN0KHRoaXMuY29udm9sdmVyKTtcbiAgICAgICAgdGhpcy5jb252b2x2ZXIuY29ubmVjdCh0aGlzLm9mZmxpbmVBdWRpb0N0eC5kZXN0aW5hdGlvbik7XG5cbiAgICB9XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=